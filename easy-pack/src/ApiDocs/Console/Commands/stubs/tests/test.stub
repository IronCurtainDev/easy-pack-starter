<?php

namespace {{ namespace }};

use Tests\Feature\AutoGen\API\APIBaseTestCase;

/**
 * Auto-generated API Test
 *
 * ╔═══════════════════════════════════════════════════════════════╗
 * ║              AUTO-GENERATED. DO NOT EDIT THIS FILE.           ║
 * ╠═══════════════════════════════════════════════════════════════╣
 * ║  If you need to customize this test, copy it to:              ║
 * ║  tests/Feature/Manual/API/{{ version }}/{{ className }}.php   ║
 * ║  The auto-generator will skip tests that have a Manual copy.  ║
 * ╚═══════════════════════════════════════════════════════════════╝
 *
 * Endpoint: {{ method }} {{ uri }}
 * Group: {{ group }}
 * Summary: {{ summary }}
 *
 * @package {{ namespace }}
 */
class {{ className }} extends APIBaseTestCase
{
    /**
     * Test {{ summary }}
     *
     * @return void
     */
    public function {{ testName }}(): void
    {
        @if($method === 'GET')
        $response = $this->apiGet('{{ pathSuffix }}'@if(!empty($queryParams)), {{ queryParams }}@endif);
        @elseif($method === 'POST')
        $response = $this->apiPost('{{ pathSuffix }}', {!! $requestBody !!});
        @elseif($method === 'PUT')
        $response = $this->apiPut('{{ pathSuffix }}', {!! $requestBody !!});
        @elseif($method === 'PATCH')
        $response = $this->apiPatch('{{ pathSuffix }}', {!! $requestBody !!});
        @elseif($method === 'DELETE')
        $response = $this->apiDelete('{{ pathSuffix }}');
        @endif

        // Assert successful response
        $this->assertApiSuccess($response);

        @if(!empty($responseStructure))
        // Assert response structure
        $response->assertJsonStructure({!! $responseStructure !!});
        @endif

        // Save response for documentation
        $this->saveResponseToFile($response, '{{ responseFileName }}');
    }

    @if($method !== 'GET' && $method !== 'DELETE')
    /**
     * Test {{ summary }} with invalid data
     *
     * @return void
     */
    public function {{ testName }}_validation_error(): void
    {
        $response = $this->api{{ ucfirst(strtolower($method)) }}('{{ pathSuffix }}', []);

        // Assert validation error (if endpoint requires data)
        // $this->assertValidationError($response);
        $response->assertStatus(422)->assertJsonStructure(['message']);
    }
    @endif

    /**
     * Test {{ summary }} without authentication
     *
     * @return void
     */
    public function {{ testName }}_unauthenticated(): void
    {
        // Remove authentication
        $this->app['auth']->forgetGuards();

        @if($method === 'GET')
        $response = $this->getJson($this->apiBasePath . '{{ pathSuffix }}');
        @elseif($method === 'POST')
        $response = $this->postJson($this->apiBasePath . '{{ pathSuffix }}', []);
        @elseif($method === 'PUT')
        $response = $this->putJson($this->apiBasePath . '{{ pathSuffix }}', []);
        @elseif($method === 'PATCH')
        $response = $this->patchJson($this->apiBasePath . '{{ pathSuffix }}', []);
        @elseif($method === 'DELETE')
        $response = $this->deleteJson($this->apiBasePath . '{{ pathSuffix }}');
        @endif

        // Assert unauthorized (comment out if endpoint is public)
        // $this->assertUnauthorized($response);
        $response->assertStatus(401);
    }
}
